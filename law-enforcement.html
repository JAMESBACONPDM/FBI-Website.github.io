<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>Federal Bureau of Investigation ‚Äî RP (Law Enforcement)</title>
  <link rel="stylesheet" href="common.css" />
  <style>
    /* LEO v3 ‚Äî rebuilt clean */
    .lock-badge{font-size:.8rem;padding:.15rem .4rem;border:1px solid currentColor;border-radius:.35rem;opacity:.8}
    .panel{background:#0b1a2a0d;border:1px solid #0b1a2a22;border-radius:.75rem;padding:1rem}
    .grid{display:grid;gap:1rem}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .field{display:flex;flex-direction:column;gap:.25rem}
    .field label{font-weight:600}
    .field input,.field textarea,.field select{padding:.6rem .7rem;border:1px solid #d0d4da;border-radius:.5rem;font:inherit}
    .btn{padding:.7rem 1rem;border:1px solid #0b1a2a;border-radius:.5rem;background:#0b1a2a;color:#fff;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .muted{opacity:.7}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #e6e9ee;padding:.6rem .5rem;text-align:left;vertical-align:top}
    .notice{padding:.8rem 1rem;border:1px solid #e9b64b;background:#fff7e6;border-radius:.5rem}
    .hidden{display:none}
    .pw-wrap{position:relative;display:flex;align-items:center;gap:.5rem}
    .pw-wrap input{flex:1;padding-right:2.2rem}
    .pw-toggle{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer;font:inherit;opacity:.95;z-index:2;pointer-events:auto}
    .flash{display:none;margin-top:.6rem;padding:.6rem .8rem;border-radius:.4rem;border:1px solid #9ad29a;background:#ebffeb}
    .flash.show{display:block}
  </style>
</head>
<body>
  <div class="rp-banner">RP ‚Ä¢ ROBLOX</div>
  <header>
    <div class="wrap top">
      <div class="seal"><span>FBI</span></div>
      <div class="brand">
        <h1>Federal Bureau of Investigation <small class="muted">RP</small></h1>
        <p class="muted">For training and entertainment in a roleplay setting ‚Ä¢ Not affiliated with the real FBI</p>
      </div>
    </div>
    <nav class="nav">
      <div class="wrap">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="most-wanted.html">Most Wanted</a></li>
          <li><a href="news.html">News</a></li>
          <li><a href="investigations.html">What We Investigate (RP)</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="tip.html">Report a Tip</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="law-enforcement.html" class="active">Law Enforcement <span class="lock-badge">LOCKED</span></a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main class="wrap" style="margin-top:1.5rem">
    <h2>Law Enforcement Portal <span class="lock-badge">Restricted</span></h2>
    <p class="muted">Authorized LEOs only. All actions are logged to Discord via webhook (RP).</p>

    <!-- Gate -->
    <div id="gate" class="panel">
      <h3>Enter Password</h3>
      <div class="grid grid-3">
        <div class="field">
          <label for="pw">Password</label>
          <div class="pw-wrap">
            <input id="pw" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
            <button type="button" id="pwToggle" class="pw-toggle" aria-label="Show password" title="Show password">üëÅÔ∏è</button>
          </div>
        </div>
        <div class="field">
          <label for="badge">Badge #</label>
          <input id="badge" type="text" placeholder="e.g., 217" />
        </div>
        <div class="field">
          <label>&nbsp;</label>
          <button id="unlock" class="btn">Unlock</button>
        </div>
      </div>
      <div id="gate-error" class="notice hidden">Invalid password. Check with an Admin.</div>
      <div id="gate-success" class="flash">Access granted. Loading portal‚Ä¶</div>
      <div id="pw-hint" class="muted hidden" style="margin-top:.25rem;font-size:.9rem"></div>
      <div class="muted" style="margin-top:.5rem">Build: <code>LEO v3</code></div>
    </div>

    <!-- App -->
    <section id="app" class="hidden" style="margin-top:1.5rem">
      <div class="panel">
        <h3>Create Case File</h3>
        <div class="grid grid-2">
          <div class="field">
            <label for="caseId">Case #</label>
            <input id="caseId" placeholder="e.g., 25-0812-001" />
          </div>
          <div class="field">
            <label for="caseDate">Date</label>
            <input id="caseDate" type="date" />
          </div>
          <div class="field">
            <label for="officer">Officer (Name / Badge)</label>
            <input id="officer" placeholder="A. Smith / 217" />
          </div>
          <div class="field">
            <label for="agency">Agency</label>
            <select id="agency">
              <option>FBI</option>
              <option>MPD</option>
              <option>USSS</option>
              <option>USMS</option>
              <option>DOJ</option>
              <option>CIA</option>
              <option>DSS</option>
            </select>
          </div>
          <div class="field">
            <label for="suspect">Suspect(s)</label>
            <input id="suspect" placeholder="Name(s)" />
          </div>
          <div class="field">
            <label for="status">Status</label>
            <select id="status">
              <option>Open</option>
              <option>Closed</option>
              <option>Referred</option>
              <option>Inactive</option>
            </select>
          </div>
          <div class="field">
            <label for="compartment">Compartment Marking</label>
            <select id="compartment">
              <option>None</option>
              <option>NOFORN</option>
              <option>ORCON</option>
              <option>REL TO USA, FVEY</option>
              <option>HCS</option>
              <option>TALENT KEYHOLE</option>
              <option>SI</option>
              <option>G</option>
              <option>RSEN</option>
            </select>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label for="charges">Charges</label>
            <textarea id="charges" rows="2" placeholder="List statutes / violations"></textarea>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label for="narrative">Narrative</label>
            <textarea id="narrative" rows="5" placeholder="Brief case summary"></textarea>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label for="evidence">Evidence Links</label>
            <input id="evidence" placeholder="Paste URLs, comma-separated (images, videos, docs)" />
          </div>
        </div>
        <div style="margin-top:1rem;display:flex;gap:.5rem;align-items:center">
          <button id="submit" class="btn">Submit to Log</button>
          <span class="muted">Sends to Main + Agency webhook and saves on this device.</span>
        </div>
      </div>

      <div class="panel" style="margin-top:1rem">
        <h3>Recent Submissions (This Device)</h3>
        <table class="table" id="table">
          <thead>
            <tr>
              <th>Case #</th><th>Date</th><th>Officer</th><th>Agency</th><th>Suspect(s)</th><th>Status</th><th>Compartment</th><th>Charges</th><th>Narrative</th><th>Evidence</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap fine" style="margin-top:1rem">¬© <span id="y"></span> RP Community. For entertainment and training purposes only.</div>
  </footer>

  <script>
  // ==== CONFIG (v3) ====
  // Main webhook (high-ups only); preserved from your prior file if present.
  const LEO_WEBHOOK = "YOUR_MAIN_WEBHOOK_URL_HERE";
  const MAIN_WEBHOOK = LEO_WEBHOOK;

  // Per-agency webhooks ‚Äî fill these in as needed.
  const AGENCY_WEBHOOKS = {
    "FBI": "",
    "MPD": "",
    "USSS": "",
    "USMS": "",
    "DOJ": "",
    "CIA": "",
    "DSS": ""
  };

  // Password settings
  const FIXED_PASSWORD = "LEO-0925-Secure"; // set a new one anytime
  // Optional weekly model (kept for later if you want to switch back)
  const WEEKLY_SECRET = "BULLDOG"; // format SECRET-YYYYWW when enabled

  // Storage/session keys
  const storageKey = "leo_cases_v3";
  const sessionKey = "leo_unlocked_v3";

  // ==== UTIL ====
  const $ = sel => document.querySelector(sel);
  function isoWeek(d){
    const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay()||7));
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
    const weekNo = Math.ceil((((date - yearStart)/86400000)+1)/7);
    return [date.getUTCFullYear(), weekNo.toString().padStart(2,'0')];
  }
  function expectedPassword(){
    // Currently using fixed password. To use weekly, return `${WEEKLY_SECRET}-${isoWeek(new Date()).join("")}` instead.
    return FIXED_PASSWORD;
  }
  function unlocked(){ return sessionStorage.getItem(sessionKey) === "1"; }
  function setUnlocked(v){ sessionStorage.setItem(sessionKey, v ? "1" : "0"); }
  function toggleUI(){
    const show = unlocked();
    $("#gate").classList.toggle("hidden", show);
    $("#app").classList.toggle("hidden", !show);
  }
  function loadCases(){
    try { return JSON.parse(localStorage.getItem(storageKey) || "[]"); }
    catch(e){ return []; }
  }
  function saveCases(list){ localStorage.setItem(storageKey, JSON.stringify(list)); }
  function renderTable(){
    const tbody = $("#table tbody"); tbody.innerHTML = "";
    for(const c of loadCases().slice().reverse()){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${c.caseId||""}</td>
        <td>${c.caseDate||""}</td>
        <td>${c.officer||""}</td>
        <td>${c.agency||""}</td>
        <td>${c.suspect||""}</td>
        <td>${c.status||""}</td>
        <td>${c.compartment||""}</td>
        <td>${(c.charges||"").replaceAll("\n","<br/>")}</td>
        <td>${(c.narrative||"").replaceAll("\n","<br/>")}</td>
        <td>${(c.evidence||"").split(",").map(s=>s.trim()).filter(Boolean).map(u=>`<a href="${u}" target="_blank" rel="noopener">link</a>`).join(", ")}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  // ==== EVENTS ====
  function doUnlock(){
    const input = $("#pw").value.trim();
    const ok = input && input === expectedPassword();
    $("#gate-error").classList.toggle("hidden", ok);
    $("#gate-success").classList.toggle("show", ok);
    if (ok){ setUnlocked(true); toggleUI(); }
  }
  $("#unlock").addEventListener("click", doUnlock);
  $("#pw").addEventListener("keydown", (e)=>{ if(e.key==="Enter") doUnlock();});
  $("#pwToggle").addEventListener("click", ()=>{
    const pw = $("#pw");
    const btn = $("#pwToggle");
    const show = pw.type === "password";
    pw.type = show ? "text" : "password";
    btn.setAttribute("aria-label", show ? "Hide password" : "Show password");
    btn.setAttribute("title", show ? "Hide password" : "Show password");
    btn.setAttribute("aria-pressed", show ? "true" : "false");
    btn.textContent = show ? "üôà" : "üëÅÔ∏è";
  });

  $("#submit").addEventListener("click", async () => {
    const payload = {
      caseId: $("#caseId").value.trim(),
      caseDate: $("#caseDate").value,
      officer: $("#officer").value.trim() || $("#badge").value.trim(),
      agency: $("#agency").value,
      suspect: $("#suspect").value.trim(),
      status: $("#status").value,
      compartment: $("#compartment").value,
      charges: $("#charges").value.trim(),
      narrative: $("#narrative").value.trim(),
      evidence: $("#evidence").value.trim(),
      ts: new Date().toISOString()
    };

    // Save local copy
    const list = loadCases(); list.push(payload); saveCases(list); renderTable();

    // Build embed
    const embed = {
      title: `LEO Case ‚Ä¢ ${payload.caseId || "Unnumbered"}`,
      description: payload.narrative?.slice(0, 1500) || "(no narrative)",
      fields: [
        {name:"Date", value: payload.caseDate || "‚Äî", inline:true},
        {name:"Status", value: payload.status || "‚Äî", inline:true},
        {name:"Officer", value: payload.officer || "‚Äî", inline:true},
        {name:"Agency", value: payload.agency || "‚Äî", inline:true},
        {name:"Suspect(s)", value: payload.suspect || "‚Äî", inline:false},
        {name:"Compartment", value: payload.compartment || "‚Äî", inline:true},
        {name:"Charges", value: payload.charges || "‚Äî", inline:false},
        {name:"Evidence", value: (payload.evidence||"‚Äî"), inline:false},
      ],
      timestamp: payload.ts
    };

    async function sendWebhook(url){
      return fetch(url, { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({ embeds: [embed] }) });
    }

    try {
      // Always send to Main
      if (MAIN_WEBHOOK && MAIN_WEBHOOK.startsWith("https://")) { await sendWebhook(MAIN_WEBHOOK); }
      // Optionally send to Agency
      const agencyUrl = AGENCY_WEBHOOKS[payload.agency];
      if (agencyUrl && agencyUrl.startsWith("https://")) { await sendWebhook(agencyUrl); }
    } catch(e) {
      console.error("Webhook error", e);
      alert("Saved locally. Webhook send failed ‚Äî check console and URLs.");
    }
  });

  // On load
  document.getElementById('y').textContent = new Date().getFullYear();
  const qp = new URLSearchParams(location.search);
  if (qp.get("debug")==="1"){ const hint = document.getElementById("pw-hint"); if (hint){ hint.textContent = "(debug) Expected password: " + expectedPassword(); hint.classList.remove("hidden"); } }
  if (qp.get("pass") === expectedPassword()){ setUnlocked(true); }
  toggleUI(); renderTable();
  </script>
</body>
</html>
